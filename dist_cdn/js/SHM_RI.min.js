var sStorage_Key="SHMI__"+location.pathname.substring(location.pathname.lastIndexOf("/")+1).replace(/\..+$/,""),updateInterval=1E3,ig_Snap=10;
$(function(){function g(){for(var a,b=0;b<localStorage.length;b++)a=JSON.parse(localStorage.getItem(localStorage.key(b))),"RI"==a.type&&($("#"+a.id).offset({top:a.top,left:a.left}),$("#"+a.id).css("height",a.height),$("#"+a.id).css("width",a.width),$("#"+a.id).css("rotate",a.rotate))}function h(){$(".instrument, .instrumentF, .instrumentG").on("clayfy-drop clayfy-resizeend",function(a){parent.top.$("#IDcoord").html("");a=a.target;var b={id:a.id,type:"RI",left:Math.round($("#"+a.id).offset().left),
top:Math.round($("#"+a.id).offset().top),height:a.clientHeight,width:a.clientWidth,rotate:0};localStorage.setItem(sStorage_Key+"__"+a.id,JSON.stringify(b))});$(".instrument, .instrumentF, .instrumentG").on("clayfy-drag clayfy-dragstart clayfy-resize clayfy-resizestart",function(a){a=a.target;var b=$("#"+a.id).position().left,c=$("#"+a.id).position().top;0==!ig_Snap&&(b=(b/ig_Snap).toFixed()*ig_Snap,c=(c/ig_Snap).toFixed()*ig_Snap,$("#"+a.id).css("left",b),$("#"+a.id).css("top",c));parent.top.$("#IDcoord").html(Math.round(c)+
" / "+Math.round(b)+" | "+a.clientHeight+" / "+a.clientWidth)})}function f(a){var b="",c='<div class="SHMI_drag SHMI_drag_%2 instrument shadow" title="'+a+'" id="ID_'+a+'">\n\t\t\t\t<span id="ID_'+a+'_A" class="float-right"></span>\n\t\t\t\t<br />\n\t\t\t\t<div id="ID_%2" class="progress" style="padding-top:3px;margin-top:5px; height:20px;background-color:var(--SHMI_widget_bg)">\n\t\t\t\t\t<span id="ID_'+a+'_spark" class="peity-%3 chart-%3">\n\t\t\t\t\t0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>',
e='<div class="SHMI_drag SHMI_drag_%2 instrument shadow" title="'+a+'" id="ID_'+a+'">\n\t\t\t\t<span id="ID_'+a+'_A" class="float-right"></span>\n\t\t\t\t<br />\n\t\t\t\t<div id="ID_%2" class="progress" style="padding:1px; margin-top:5px; height:20px;background-color:var(--SHMI_widget_bg)">\n\t\t\t\t\t<div id="ID_'+a+'_M" class="progress-bar" role="progressbar"></div>\n\t\t\t\t</div>\n\t\t\t</div>',d='<div class="SHMI_drag_level SHMI_drag_%2 instrumentF" title="'+a+'" id="ID_'+a+'">\n\t\t\t\t<div id="ID_'+
a+'_L" class="SHMI_level">\n\t\t\t\t\t\t<span id="ID_'+a+'_A" class="SHMI_level_value" ></span>\n\t\t\t\t</div>\n\t\t\t</div>',f='<div class="SHMI_drag gauge SHMI_drag_%2 d-flex instrumentG justify-content-center align-middle shadow" title="'+a+'" id="ID_'+a+'">\n\t\t\t\t<span id="ID_'+a+'_A" style="position:absolute; top:18px;"></span>\n\t\t\t\t<span id="ID_'+a+'_donut" class="donut donut-%3">0/100</span>\n\t\t\t</div>';-1!==a.indexOf("AI")&&-1!==a.indexOf("_S")?b+=c.replace(/%2/g,"AI").replace(/%3/g,
"ai"):-1!==a.indexOf("AO")&&-1!==a.indexOf("_S")?b+=c.replace(/%2/g,"AO").replace(/%3/g,"ao"):-1!==a.indexOf("AI")&&-1!==a.indexOf("_G")?b+=f.replace(/%2/g,"AI").replace(/%3/g,"ai"):-1!==a.indexOf("AO")&&-1!==a.indexOf("_G")?b+=f.replace(/%2/g,"AO").replace(/%3/g,"ao"):-1!==a.indexOf("AI")&&-1!==a.indexOf("_L")?b+=d.replace(/%2/g,"AI"):-1!==a.indexOf("AI")?b+=e.replace(/%2/g,"AI"):-1!==a.indexOf("AO")&&(b+=e.replace(/%2/g,"AO"));$("#IDpict").prepend(b);$(".instrument").clayfy({type:"resizable",container:"#IDpict",
droppable:"#IDpict",minSize:[100,55],maxSize:[300,55],top:!1,bottom:!1});$(".instrumentF").clayfy({type:"resizable",container:"#IDpict",droppable:"#IDpict",minSize:[20,50],maxSize:[1E3,1E3]});$(".instrumentG").clayfy({type:"dropable",container:"#IDpict",droppable:"#IDpict",minSize:[55,55],maxSize:[55,55]});$(".peity-ai").peity("line",{fill:["var(--sparkline_ai_fill)"],stroke:"var(--sparkline_ai_stroke)",min:0,max:100,width:"100%",strokeWidth:2});$(".peity-ao").peity("line",{fill:["var(--sparkline_ao_fill)"],
stroke:"var(--sparkline_ao_stroke)",min:0,max:100,width:"100%",strokeWidth:2});$(".donut-ai").peity("donut",{fill:["var(--sparkline_ai_stroke)","var(--SHMI_widget_bg)"],innerRadius:15,radius:22});$(".donut-ao").peity("donut",{fill:["var(--sparkline_ao_stroke)","var(--SHMI_widget_bg)"],innerRadius:15,radius:22});h();g()}function k(a){var b="",c='<div class="SHMI_drag SHMI_drag_D%2 instrument nobr shadow" title="'+a+'" id="ID_'+a+'" style="height:55px">\n\t\t\t\t\t\t<span>'+a+'</span>\n        \t\t\t\t<span id="TS_'+
a+'" class="font-weight-lighter float-right" style="display:inline-block;font-size:x-small;"></span>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<div class="mx-auto" style="width:20px; height:15px; margin-top:5px;">\n\t\t\t\t\t\t\t\t<div class="digi_IO">\n\t\t\t\t\t\t\t\t\t<span class="digi_back"></span>\n\t\t\t\t\t\t\t\t\t<span id="ID_'+a+'_D" class="%3" style="left:0"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>';-1!=a.indexOf("DI")?b+=c.replace(/%2/g,"I").replace(/%3/g,"digi_in"):
-1!=a.indexOf("DO")&&(b+=c.replace(/%2/g,"O").replace(/%3/g,"digi_out"));$("#IDpict").prepend(b);$(".instrument").clayfy({type:"resizable",container:"#IDpict",minSize:[50,50],maxSize:[300,50],top:!1,bottom:!1});h();g()}function l(){var a,b,c,e,d=[["#000000"],["var(--SHMI_signal_on)"],["var(--warning)"],,["var(--danger)"],,,,["var(--info)"]];parent.top.$("#IDdata").find("input").each(function(){a=this.value;b=this.id;timeStamp=moment.unix(parent.top.$("#"+b+"_TS_upd").val());$("#ID_"+b).attr("title",
b+" | "+timeStamp.format("ll HH:mm:ss"));if(-1!=b.indexOf("D"))$("#ID_"+b+"_D").css("opacity",a),0<a&&8>a?$("#ID_"+b+"_D").css("background-color",d[a]):$("#ID_"+b+"_D").css("background-color","transparent"),60<$("#ID_"+b).width()?$("#TS_"+b).text(timeStamp.format("HH:mm:ss")):$("#TS_"+b).text(""),a&1|a&2|a&4&&8>a?(-1!=b.indexOf("DO")&&($("#SHMI_"+b+"_D").css("stroke",d[a]),$("#SHMI_"+b+"_D").css("stroke-width","3")),-1!=b.indexOf("DI")&&($("#SHMI_"+b+"_D").css("stroke",d[a]),$("#SHMI_"+b+"_D").css("stroke-width",
"3"))):0==a&&($("#SHMI_"+b+"_D").css("stroke",d[0]),$("#SHMI_"+b+"_D").css("stroke-width","1"));else if(-1!=b.indexOf("AI")||-1!=b.indexOf("AO"))$("#ID_"+b+"_A").text(Round(a)+"%"),$("#ID_"+b+"_S_A").text(Round(a)+"%"),$("#ID_"+b+"_M").css("width",a+"%"),$("#ID_"+b+"_L_L").css("height",a+"%"),$("#ID_"+b+"_L_A").text(Round(a)+"%"),$("#SHMI_"+b+"_A").text(Round(a)+"%"),a=Math.round(a),c=$("#ID_"+b+"_S_spark").peity("line"),e=c.text().split(","),e.shift(),e.push(Round(a,0)),c.text(e.join(",")).change(),
$("#ID_"+b+"_G_A").text(a),updatingDonat=$("#ID_"+b+"_G_donut").peity("donut"),updatingDonat.text(a+"/100").change()});setTimeout(l,updateInterval)}(function(){var a="./pict/"+location.pathname.substring(location.pathname.lastIndexOf("/")+1).replace(/\..+$/,"");$("#IDpict").append('<img id="ID_RI_image" src="'+a+'.svg" alt="RI" class="svg">');$(".svg").on("error",function(){$(this).attr("src",a+".png");$(this).removeClass("svg")});$.getJSON("./data/data.json",function(a){$.each(a,function(a,b){-1==
a.indexOf("SP")&&(-1!==a.indexOf("DI")?$("#ID_option_DI").append($("<option>",{value:a,text:a})):-1!==a.indexOf("DO")?$("#ID_option_DO").append($("<option>",{value:a,text:a})):-1!==a.indexOf("AI")?($("#ID_option_AI").append($("<option>",{value:a,text:a+" Meter"})),$("#ID_option_AIS").append($("<option>",{value:a+"_S",text:a+" Sparkline"})),$("#ID_option_AIG").append($("<option>",{value:a+"_G",text:a+" Gauge"})),$("#ID_option_AIL").append($("<option>",{value:a+"_L",text:a+" Level"}))):-1!==a.indexOf("AO")&&
($("#ID_option_AO").append($("<option>",{value:a,text:a+" Meter"})),$("#ID_option_AOS").append($("<option>",{value:a+"_S",text:a+" Sparkline"})),$("#ID_option_AOG").append($("<option>",{value:a+"_G",text:a+" Gauge"}))))})}).done(function(){$(".js-example-basic-multiple").select2();for(var a=[],c=[],e,d=0;d<localStorage.length;d++)e=JSON.parse(localStorage.getItem(localStorage.key(d))),"RI"==e.type&&0==$("#"+e.id).length&&(-1!=e.id.indexOf("D")&&c.push(e.id.substr(3,10)),-1!=e.id.indexOf("A")&&a.push(e.id.substr(3,
10)),k(e.id.substr(3,10)),f(e.id.substr(3,10)));$("#ID_Select_DI, #ID_Select_DO").val(c).trigger("change");$("#ID_Select_AI, #ID_Select_AO").val(a).trigger("change")})})();$('img[src$=".svg"]').each(function(){var a=jQuery(this),b=a.attr("id"),c=a.attr("class"),e=a.attr("src");jQuery.get(e,function(d){d=jQuery(d).find("svg");"undefined"!==typeof b&&(d=d.attr("id",b));"undefined"!==typeof c&&(d=d.attr("class",c+" replaced-svg"));d=d.removeAttr("xmlns:a");a.replaceWith(d)},"xml")});$("#ID_Select_DI, #ID_Select_DO, #ID_Select_AI, #ID_Select_AO").on("select2:unselect",
function(a){$("#ID_"+a.params.data.id).remove();localStorage.removeItem(sStorage_Key+"__ID_"+a.params.data.id)});$("#ID_Select_DI, #ID_Select_DO").on("select2:select",function(a){k(a.params.data.id)});$("#ID_Select_AI, #ID_Select_AO").on("select2:select",function(a){f(a.params.data.id)});$("#ID_Style").change(function(){var a=document.body.style,b=parseInt($(this).val());0<b?(a.setProperty("--SHMI_drag_bg","var(--SHMI_drag_bg_"+b+")"),a.setProperty("--SHMI_drag_txt","var(--SHMI_drag_txt_"+b+")"),
a.setProperty("--SHMI_widget_bg","var(--SHMI_widget_bg_"+b+")")):(a.setProperty("--SHMI_drag_bg","var(--dark)"),a.setProperty("--SHMI_drag_txt","var(--light)"),a.setProperty("--SHMI_widget_bg","rgba(0,0,0,0.5)"))});$(function(){l()})});
