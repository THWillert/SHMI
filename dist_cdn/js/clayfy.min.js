!function(){function E(){function o(e){if(e.originalEvent.touches&&1==e.originalEvent.touches.length)e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];n.diffX=n.firstX-e.pageX,n.diffY=n.firstY-e.pageY}var n,a=null,r=function(){$(document).off("mouseup touchend",r),a&&(clearTimeout(a),$(document).off("mousemove touchmove",o))};this.callFunction=function(e,t,i){if(!t)return i(e);n={firstX:e.pageX,firstY:e.pageY,diffX:0,diffY:0},$(document).on("mousemove touchmove",o),$(document).on("mouseup touchend",r),a=setTimeout(function(){$(document).off("mousemove touchmove",o),Math.abs(n.diffX)<5&&Math.abs(n.diffY)<5&&i(e)},t)}}function c(e,t){this.el=e instanceof $?e:$(e),this.draggableBox,this.x,this.y,this.dX,this.dY,this.diffDX,this.diffDY,this.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0},this.actualPos,this.originalPos,this.initPos={y:0,x:0,scrollTop:null,scrollLeft:null},this.bounderies={},this.droppedTarget,this.scrollable=[],this.container={},this.tempContainer=$("<div>",{style:"position: absolute; top:0; left:0"}),this.droppable={dragElement:[],dropArea:[]},this.status="ready",this.callableIfNotMove=new E,this.settings=$.extend(!0,{},$.clayfy.settings,t);var o,i,b=this,n=!1,a=$("body"),r=$("<div>",{style:"height:100%;width:100%;position:fixed;top:0;left:0"});this.contentGhost;var v,m,w,x,s=function(){b.settings.ghost?(!0===b.settings.ghost?(b.draggableBox=b.el.clone(),b.draggableBox.addClass("clayfy-ghost-opacity")):(b.draggableBox=$("<div>",{margin:b.el.css("margin")}),b.contentGhost=$('<div class="clayfy-ghost-content" style="position:absolute"></div>'),b.draggableBox.append(b.contentGhost)),b.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-ghost")):b.draggableBox=b.el},l=function(e){if("canceling"!==b.status&&b.settings.move){var t=b.getPosition(),i=b.draggableBox.offset();b.contentGhost?b.contentGhost:b.draggableBox;if(b.container.offset){var o=b.container.offset.innerBottom,n=b.container.offset.innerRight;i.top>=o-b.el.outerHeight()&&(t.y+=o-b.el.outerHeight()-i.top),i.left>=n-b.el.outerWidth()&&(t.x+=n-b.el.outerWidth()-i.left)}if(b.el.css({top:t.y,left:t.x}),"clayfy-dropinside"===e.type){o=e.area.offset.innerBottom,n=e.area.offset.innerRight;i.top>=o-b.el.outerHeight()&&(t.y+=o-b.el.outerHeight()-i.top),i.left>=n-b.el.outerWidth()&&(t.x+=n-b.el.outerWidth()-i.left),b.el.css({top:t.y,left:t.x})}}b.draggableBox.detach()},d=function(){var e=b.settings.container;e instanceof I?b.container=e:b.settings.container&&(b.container=new I(b.el,e))},g=function(e){27===e.keyCode&&b.cancel(e)};this.cancel=function(e){b.status="canceling",b.draggableBox.animate({top:b.initPos.y,left:b.initPos.x},100,function(){b.draggableBox.trigger("mouseup"),b.status="ready"}),null!==b.initPos.scrollTop&&b.initPos.parent.animate({scrollTop:b.initPos.scrollTop},100),null!==b.initPos.scrollLeft&&b.initPos.parent.animate({scrollLeft:b.initPos.scrollLeft},100)},b.scrollables=[];var f=function(){$(b.settings.scrollable).each(function(){var e=$(this);if(!e.length)return!0;var t=p(e);if(!t.x&&!t.y)return!0;var i=e[0].getBoundingClientRect(),o=c(e),n=parseInt(e.css("border-top-width")),a=parseInt(e.css("border-left-width")),r={el:e,top:i.top+n,bottom:i.top+o.innerHeight+n,left:i.left+a,right:i.left+o.innerWidth+a,innerHeight:o.innerHeight,innerWidth:o.innerWidth,interval:{top:!1,bottom:!1,left:!1,right:!1},isParent:!b.settings.overflow&&b.el.offsetParent().is(e),isBody:e.is("body")};if(r.isBody){var s=$(window);r.top=0,r.left=0,r.bottom=s.height(),r.right=s.width(),r.innerHeight=s.height(),r.innerWidth=s.width()}b.scrollables.push(r)})},p=function(e){var t=!1,i=!1,o=$(window);return e.is("body")?(a.height()>o.height()&&(i=!0),a.width()>o.width()&&(t=!0)):(e[0].scrollHeight>e.height()&&(i=!0),e[0].scrollWidth>e.width()&&(t=!0)),{x:t,y:i}},c=function(e){var t,i,o,n,a,r,s,l=e instanceof $?e:$(e);return l.length?(t=l[0].style.position,"static"===l.css("position")&&l.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),l.append(o),n=i.width(),a=i.height(),r=parseInt(i.css("border-top-width")),s=parseInt(i.css("border-left-width")),o.remove(),l[0].style.position=t,{innerWidth:n,innerHeight:a,innerOffset:{top:r,left:s,bottom:a+r,right:n+s}}):{width:0,height:0}};var h=function(e){var t,i,o=b.contentGhost?b.contentGhost:b.draggableBox,n=b.draggableBox[0].getBoundingClientRect(),a=o.offset(),r={top:n.top,bottom:n.top+o.outerHeight(),left:n.left,right:n.left+o.outerWidth(),x:0,y:0};r.x=(r.right-r.left)/2+r.left,r.y=(r.bottom-r.top)/2+r.top,0<b.history.diffDY&&v&&(v=!1,b.y=Math.min(a.top+o.outerHeight(),e.pageY)),b.history.diffDY<0&&m&&(m=!1,b.y=Math.max(a.top,e.pageY)),0<b.history.diffDX&&x&&(x=!1,b.x=Math.min(a.left+o.outerWidth(),e.pageX)),b.history.diffDX<0&&w&&(w=!1,b.x=Math.max(a.left,e.pageX));for(var s=0,l=b.scrollables.length;s<l;s++){var d=b.scrollables[s],g=0,f=r.top-d.top,p=d.bottom-r.bottom,c=r.left-d.left,h=d.right-r.right,u=r.x<d.right&&r.x>d.left,y=r.y<d.bottom&&r.y>d.top;if((i=d).el[0].scrollHeight-i.el.scrollTop()!==i.innerHeight&&p<6&&(-6<p||d.isBody)&&u?(z(e,d,"bottom"),B(d,"top"),g++):(B(d,"bottom"),d.el.scrollTop()&&f<6&&(-6<f||d.isBody)&&u?(z(e,d,"top"),g++):B(d,"top")),d.el.scrollLeft()&&c<6&&(-6<c||d.isBody)&&y?(z(e,d,"left"),B(d,"right"),g++):(B(d,"left"),(t=d).el[0].scrollWidth-t.el.scrollLeft()!==t.innerWidth&&h<6&&(-6<h||d.isBody)&&y?(z(e,d,"right"),g++):B(d,"right")),g)break}},z=function(t,i,e){i.interval[e]&&clearInterval(i.interval[e]);var o=function(e){};switch(e){case"bottom":o=function(e){e=e||10,i.el.scrollTop(i.el.scrollTop()+e),i.isParent&&(b.x=t.pageX,b.setBounderies(),b.updateDropArea(),v=!0)};break;case"top":o=function(e){e=e||10,i.el.scrollTop(i.el.scrollTop()-e),i.isParent&&(b.x=t.pageX,b.setBounderies(),b.updateDropArea(),m=!0)};break;case"left":o=function(e){e=e||10,i.el.scrollLeft(i.el.scrollLeft()-e),i.isParent&&(b.y=t.pageY,b.setBounderies(),b.updateDropArea(),w=!0)};break;case"right":o=function(e){e=e||10,i.el.scrollLeft(i.el.scrollLeft()+e),i.isParent&&(b.y=t.pageY,b.setBounderies(),b.updateDropArea(),x=!0)}}o(3),i.isParent||(i.interval[e]=setInterval(o,50))},B=function(e,t){if(t)e.interval[t]&&(clearInterval(e.interval[t]),e.interval[t]=!1);else for(var i in b.scrollables){var o=b.scrollables[i].interval;for(var n in o)o[n]&&(clearInterval(o[n]),o[n]=!1)}};this.appendTo=function(e,t){if(t=t||b.el,(e=e instanceof $?e:$(e)).length){var i=t.offset(),o=e.offset(),n={top:i.top-o.top-parseInt(e.css("border-top-width"))+e.scrollTop(),left:i.left-o.left-parseInt(e.css("border-left-width"))+e.scrollLeft()};"static"===e.css("position")&&e.css("position","relative"),t.appendTo(e).css(n)}};var u=function(){b.el.on("clayfy-dragstart",b.updateDragElement),b.el.on("clayfy-dragstart",b.updateDropArea),b.el.on("clayfy-drag",y),b.el.on("clayfy-drop",D),b.settings.ghost&&(b.el.on("clayfy-dropinside",l),b.el.on("clayfy-dropoutside",l)),b.el.on("clayfy-dragstart",function(){P()||(b.el.removeClass("clayfy-dropinside"),b.draggableBox.removeClass("clayfy-dropinside"))}),b.el.on("clayfy-dragenter",function(e){b.el.addClass("clayfy-dragenter"),b.draggableBox.addClass("clayfy-dragenter"),e.droparea.addClass("clayfy-dragenter"),b.el[0].id&&e.droparea.addClass("clayfy-dragenter-"+b.el[0].id)}),b.el.on("clayfy-dragleave",function(e){b.el.removeClass("clayfy-dropinside"),b.draggableBox.removeClass("clayfy-dropinside"),e.droparea.removeClass("clayfy-dropinside"),b.el[0].id&&e.droparea.removeClass("clayfy-dropinside-"+b.el[0].id)}),b.el.on("clayfy-dragleave clayfy-drop",function(e){b.el.removeClass("clayfy-dragenter"),b.draggableBox.removeClass("clayfy-dragenter"),$(".clayfy-dragenter").removeClass("clayfy-dragenter"),b.el[0].id&&$(".clayfy-dragenter-"+b.el[0].id).removeClass("clayfy-dragenter-"+b.el[0].id)}),b.el.on("clayfy-dropinside",function(e){b.el.addClass("clayfy-dropinside"),b.draggableBox.addClass("clayfy-dropinside"),e.droparea.addClass("clayfy-dropinside"),b.el[0].id&&e.droparea.addClass("clayfy-dropinside-"+b.el[0].id),b.settings.migrate&&b.appendTo(e.droparea)})};this.updateDropArea=function(e){b.droppable.dropArea=[];var t=b.settings.droppable instanceof $?b.settings.droppable:$(b.settings.droppable);b.addDroppable(t)},this.updateDragElement=function(){b.droppable.dragElement=[],b.droppable.dragElement={originalPos:b.getPosition(),id:b.el[0].id,originalDropArea:null,width:b.draggableBox.width(),height:b.draggableBox.height(),outerWidth:b.draggableBox.outerWidth(),outerHeight:b.draggableBox.outerHeight(),x:0,y:0};var t=b.droppable.dragElement;t.setCenter=function(){var e=b.draggableBox.offset();t.x=e.left+t.outerWidth/2,t.y=e.top+t.outerHeight/2},t.setCenter(),t.originalDropArea=P()},this.resetDroppable=function(e){e&&(b.settings.droppable=e),b.updateDragElement(),b.updateDropArea()},this.addDroppable=function(e){(e instanceof $?e:$(e)).each(function(){var e=$(this),t=e.offset(),i=e.outerHeight(),o=e.outerWidth(),n=parseInt(e.css("border-top-width")),a=parseInt(e.css("border-left-width")),r=$.clayfy.getInner(e);b.droppable.dropArea.push({el:e,id:this.id,left:t.left,top:t.top,width:o,height:i,innerWidth:r.innerWidth,innerHeight:r.innerHeight,offset:{innerTop:t.top+n,innerLeft:t.left+a,innerBottom:r.innerHeight+t.top+n,innerRight:r.innerWidth+t.left+a},right:t.left+o,bottom:t.top+i,active:!1,triggered:!1})})};var y=function(e){var t=b.droppable.dragElement;t.setCenter();for(var i=0,o=b.droppable.dropArea.length;i<o;i++){var n=b.droppable.dropArea[i];n&&(t.x>n.left&&t.x<n.right&&t.y>n.top&&t.y<n.bottom?n.active=!0:n.active=!1,!n.triggered&&n.active?(n.triggered=!0,b.el.trigger($.Event("clayfy-dragenter",{target:n.el[0],droparea:n.el}))):n.triggered&&!n.active&&(n.triggered=!1,b.el.trigger($.Event("clayfy-dragleave",{target:n.el[0],droparea:n.el,area:n}))))}},P=function(){var e=b.droppable.dragElement;e.setCenter();for(var t=!1,i=0,o=b.droppable.dropArea.length;i<o;i++){var n=b.droppable.dropArea[i];n&&e.x>n.left&&e.x<n.right&&e.y>n.top&&e.y<n.bottom&&(n.active=!0,n.triggered=!0,t=n)}return t},D=function(){for(var e,t=0,i=b.droppable.dropArea.length;t<i;t++)b.droppable.dropArea[t].active&&(e=b.droppable.dropArea[t]);if("canceling"===b.status){if(e&&(e.active=!1,e.triggered=!1,b.el.trigger($.Event("clayfy-dragleave",{target:e.el[0],droparea:e.el}))),!(e=b.droppable.dragElement.originalDropArea))return;e.active=!0,e.triggered=!0}e?(b.el.trigger($.Event("clayfy-dropinside",{target:e.el[0],droparea:e.el,area:e})),b.settings.fit&&function(e){var t=b.contentGhost?b.contentGhost:b.draggableBox,i={},o=b.el.offset(),n=o.top,a=o.left,r=b.droppable.dragElement.outerWidth+o.left,s=b.droppable.dragElement.outerHeight+o.top;t.outerWidth()<=e.innerWidth&&(r>e.offset.innerRight&&(i.left=parseInt(t.css("left"))+e.offset.innerRight-r),a<e.offset.innerLeft&&(i.left=parseInt(t.css("left"))+e.offset.innerLeft-a)),t.outerHeight()<=e.innerHeight&&(s>e.offset.innerBottom&&(i.top=parseInt(t.css("top"))+e.offset.innerBottom-s),n<e.offset.innerTop&&(i.top=parseInt(b.el.css("top"))+e.offset.innerTop-n)),b.el.css(i)}(e)):(b.el.trigger("clayfy-dropoutside"),b.settings.dropoutside||function(){var e=b.droppable.dragElement.originalDropArea;e&&b.el.trigger($.Event("clayfy-dropinside",{target:e.el[0],droparea:e.el})),b.settings.overflow&&!b.settings.ghost?b.el.css({left:b.initPos.x-b.initPos.parent.offset().left-parseInt(b.initPos.parent.css("border-left-width"))+b.initPos.scrollLeft,top:b.initPos.y-b.initPos.parent.offset().top-parseInt(b.initPos.parent.css("border-top-width"))+b.initPos.scrollTop}):b.el.css({left:b.initPos.x,top:b.initPos.y})}(),b.settings.dropoutside&&b.settings.migrate&&b.settings.overflow&&b.appendTo(b.tempContainer)),e&&(b.droppedTarget=e.el[0])},H=function(e){if(!(i.is(e.target)||b.el.has(e.target).length&&!b.settings.propagate)&&(isTouchDevice()||void 0===e.which||1===e.which)&&function(e){var t=e.pageX-b.el.offset().left,i=e.pageY-b.el.offset().top,o=$("<div>",{style:"position:absolute;left:0;top:0;width:100%;height:100%"});b.el.append(o);var n=o.width(),a=o.height();return o.remove(),!(n<t)&&!(a<i)}(e)){if(e.originalEvent.touches&&1==e.originalEvent.touches.length)e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];e.preventDefault(),isTouchDevice()&&b.settings.mobileDelay?b.callableIfNotMove.callFunction(e,b.settings.mobileDelay,function(){Y(e),$(document).on("mousemove touchmove",W).on("mouseup touchend",X)}):b.callableIfNotMove.callFunction(e,b.settings.delay,function(){Y(e),$(document).on("mousemove touchmove",W).on("mouseup touchend",X)})}},X=function(e){if(!1,n){n=!1,document.body.style.cursor="",e.preventDefault(),isTouchDevice()&&b.settings.helperOnMobile&&T(),b.settings.overflow&&(b.appendTo(b.initPos.parent,b.draggableBox),b.appendTo(b.initPos.parent)),b.settings.coverScreen&&C(),b.settings.drop.call(b);var t=$.Event("clayfy-drop",{pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY});b.el.trigger(t),$(document).off("mousemove touchmove",W).off("mouseup touchend",X)}},Y=function(e){n=!0,b.settings.coverScreen&&A(),isTouchDevice()&&b.settings.helperOnMobile&&S(),document.body.style.cursor=o,b.settings.dragstart.call(b,e),b.el.trigger("clayfy-dragstart");var t=b.el.parent();b.initPos.parent=t,b.settings.overflow&&b.appendTo(b.tempContainer,b.draggableBox),b.settings.ghost&&function(e){var t=b.getPosition(b.el),i=b.settings.overflow?b.tempContainer:b.el.parent(),o=b.el.offset(),n=b.initPos.parent?b.initPos.parent.scrollTop():0,a=b.initPos.parent?b.initPos.parent.scrollLeft():0,r={width:b.el.width(),height:b.el.height(),top:t.y,left:t.x};if(!0!==b.settings.ghost&&(r={top:e.pageY-o.top+t.y+5-n,left:e.pageX-o.left+t.x+5-a,width:"auto",height:"auto"}),b.settings.overflow&&(r.top=o.top-n,r.left=o.left-a,!0!==b.settings.ghost&&(r.top=e.pageY-n+5,r.left=e.pageX-a+5)),b.draggableBox.css(r),b.draggableBox.appendTo(i),b.contentGhost){var s;switch(b.contentGhost.html(""),typeof b.settings.ghost){case"string":s=b.settings.ghost;break;case"function":s=b.settings.ghost()}if(b.contentGhost.append(s),b.container.offset){var l=b.container.offset.innerBottom,d=b.container.offset.innerRight,g=b.draggableBox.offset(),f=g.top+b.contentGhost.outerHeight()-l,p=g.left+b.contentGhost.outerWidth()-d;0<f&&b.draggableBox.css({top:e.pageY-o.top+t.y+5-f}),0<p&&b.draggableBox.css({left:e.pageX-o.left+t.x+5-p})}}}(e),b.x=e.pageX,b.y=e.pageY,b.setBounderies();var i=b.getPosition(b.el);b.initPos={x:i.x,y:i.y,scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),parent:t},b.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0}},S=function(){a.addClass("clayfy-body-scroll-disabled"),a.wrapInner('<div class="clayfy-scroll-disabled"></div>')},T=function(){$("body > .clayfy-scroll-disabled").contents().unwrap(),a.removeClass("clayfy-body-scroll-disabled")},W=function(e){if(!0,e.preventDefault(),e.originalEvent.touches&&1==e.originalEvent.touches.length)e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];b.dX=e.pageX-b.x,b.dY=e.pageY-b.y,$.clayfy.dX=b.dX,$.clayfy.dY=b.dY,b.history.diffDX=(b.history.dX[0]+b.history.dX[1]-(b.history.dX[2]+b.dX))/2,b.history.diffDY=(b.history.dY[0]+b.history.dY[1]-(b.history.dY[2]+b.dY))/2,b.history.dX=[b.history.dX[1],b.history.dX[2],b.dX],b.history.dY=[b.history.dY[1],b.history.dY[2],b.dY],b.fixDeltasWithBounderies(),(b.settings.move||b.settings.ghost)&&b.move(),b.settings.drag.call(b,e);var t=$.Event("clayfy-drag",{shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,altKey:e.altKey});b.el.trigger(t)},A=function(){a.append(r)},C=function(){r.detach()};this.getContainerBounderies=function(){if(!b.container.type)return!1;var e,t,i=b.draggableBox.offset(),o={};return b.container.update(),e=b.contentGhost?b.contentGhost.outerWidth():b.draggableBox.outerWidth(),t=b.contentGhost?b.contentGhost.outerHeight():b.draggableBox.outerHeight(),o={top:i.top-b.container.offset.innerTop,right:b.container.offset.innerRight-i.left-e,bottom:b.container.offset.innerBottom-i.top-t,left:i.left-b.container.offset.innerLeft},isNaN(o.top)&&(o={top:1e13,right:1e13,bottom:1e13,left:1e13}),o},this.setBounderies=function(){var e=b.settings.bounderies;b.actualPos=b.getPosition(),b.bounderies={top:-e[0],right:e[1],bottom:e[2],left:-e[3]};var t=b.getContainerBounderies();t&&(b.bounderies={top:Math.max(-t.top,b.bounderies.top),right:Math.min(t.right,b.bounderies.right),bottom:Math.min(t.bottom,b.bounderies.bottom),left:Math.max(-t.left,b.bounderies.left)})},this.move=function(){b.draggableBox.css({top:b.actualPos.y+$.clayfy.dY,left:b.actualPos.x+$.clayfy.dX})},this.getPosition=function(e){var t=b.el.offsetParent(),i=(void 0===e?b.draggableBox||b.el:e).position();return{y:i.top+t.scrollTop(),x:i.left+t.scrollLeft()}},this.fixDeltasWithBounderies=function(){$.clayfy.dX>b.bounderies.right&&($.clayfy.dX=b.bounderies.right),$.clayfy.dX<b.bounderies.left&&($.clayfy.dX=b.bounderies.left),$.clayfy.dY<b.bounderies.top&&($.clayfy.dY=b.bounderies.top),$.clayfy.dY>b.bounderies.bottom&&($.clayfy.dY=b.bounderies.bottom),b.settings.moveX||($.clayfy.dX=0),b.settings.moveY||($.clayfy.dY=0)},this.destroy=function(){},b.originalPos=b.getPosition(),b.actualPos=b.originalPos,d(),s(),b.el.addClass("clayfy-box"),b.settings.move||b.el.addClass("clayfy-not-move"),o=b.el.css("cursor"),i=$(b.settings.not),b.settings.overflow&&a.append(b.tempContainer),b.el.on("mousedown touchstart",H),b.settings.escape&&(b.el.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",g)}),b.el.on("clayfy-drop",function(){$(window).off("keydown",g)})),!1!==b.settings.scrollable&&"node"===b.container.type&&(b.settings.container instanceof I||("string"==typeof b.settings.scrollable?b.settings.scrollable=b.settings.scrollable?b.settings.scrollable+" , "+b.settings.container:b.settings.container:b.settings.scrollable instanceof $&&(b.settings.scrollable=b.settings.scrollable.add(b.settings.container)))),b.el.on("clayfy-dragstart",f),b.el.on("clayfy-drag",h),b.el.on("clayfy-drop",B),0!=b.settings.droppable?(b.updateDragElement(),b.updateDropArea(),u()):b.settings.ghost&&b.el.on("clayfy-drop",l)}function I(e,t){this.draggableEl=e instanceof $?e:$(e),this.values,this.el,this.type,this.originalDraggable,this.width=0,this.height=0,this.innerHeight=0,this.innerWidth=0,this.offset={top:0,left:0,innerBottom:0,innerRight:0,innerLeft:0,innerTop:0};var i=this,o=function(){var e=a(i.el);i.width=i.el.width(),i.height=i.el.height(),i.innerWidth=e.innerWidth,i.innerHeight=e.innerHeight,i.offset=i.el.offset(),i.offset.innerTop=i.offset.top+parseInt(i.el.css("border-top-width")),i.offset.innerLeft=i.offset.left+parseInt(i.el.css("border-left-width")),i.offset.innerBottom=i.offset.innerTop+i.innerHeight,i.offset.innerRight=i.offset.innerLeft+i.innerWidth},n=function(){var e=i.getDraggableValues();i.offset={top:e.offset.top-(e.position.top-i.originalDraggable.position.top)-i.values[0],left:e.offset.left-(e.position.left-i.originalDraggable.position.left)-i.values[3]},i.width=i.originalDraggable.outerWidth+i.values[3]+i.values[1],i.height=i.originalDraggable.outerHeight+i.values[0]+i.values[2],i.innerWidth=i.width,i.innerHeight=i.height,i.offset.innerTop=i.offset.top,i.offset.innerLeft=i.offset.left,i.offset.innerBottom=i.offset.top+i.height,i.offset.innerRight=i.offset.left+i.width},a=function(e){var t,i,o,n,a,r=e instanceof $?e:$(e);return r.length?(t=r[0].style.position,"static"===r.css("position")&&r.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),r.append(o),n=i.width(),a=i.height(),o.remove(),r[0].style.position=t,{innerWidth:n,innerHeight:a}):{width:0,height:0}};this.getDraggableValues=function(){var e=i.draggableEl.offset(),t=i.draggableEl.offsetParent();return{position:{top:i.draggableEl.position().top+t.scrollTop(),left:i.draggableEl.position().left+t.scrollLeft()},offset:e,outerWidth:i.draggableEl.outerWidth(),outerHeight:i.draggableEl.outerHeight()}},"string"==typeof t||t instanceof $?(i.el=t instanceof $?t:$(t),i.type="node","static"===i.el.css("position")&&i.el.css("position","relative"),i.update=o):(i.values=t,i.type="object",i.update=n,i.originalDraggable=i.getDraggableValues()),i.update()}function n(e,t){this.el=e instanceof $?e:$(e),this.originalSize={},this.initSize={},this.handlers=[],this.actualSize,this.newSize,this.draggable,this.preserveAspectRatio=!1,this.shift=!1,this.status="ready",this.touchableDevice;var i=$.extend(!0,{},$.clayfy.settings,{callbacks:{resizestart:function(){},resize:function(){},resizeend:function(){}}});this.settings=$.extend(!0,{},i,t);var o,r=this,n=!1,a=function(e){27===e.keyCode&&r.cancel()},s=function(){var e=["top left","top right","bottom left","bottom right","left","right","top","bottom"];r.touchableDevice&&(e=["bottom right"]),"static"===r.el.css("position")&&r.el.css("position","relative"),r.cssPosition=r.el.css("position");var t={container:r.settings.container,not:".clayfy-handler",escape:!1,droppable:r.settings.droppable};t=$.extend(!0,{},r.settings,t),r.settings.not&&(t.not+=","+r.settings.not),r.settings.move&&"relative"!==r.cssPosition||(t.move=!1),r.draggable=new c(r.el,t);for(var i=0;i<e.length;i++){var o=e[i].split(" "),n=!0;for(var a in o)r.settings.hasOwnProperty(o[a])&&r.settings[o[a]]||(n=!1);n&&r.handlers.push(new l(e[i],r))}r.touchableDevice&&r.el.addClass("clayfy-touch-device")};this.getSize=function(){r.parent=r.el.offsetParent();var e=r.parent,t=r.el.position();return{width:r.el.width(),height:r.el.height(),left:t.left+e.scrollLeft(),top:t.top+e.scrollTop(),outerWidth:r.el.outerWidth(),outerHeight:r.el.outerHeight()}},this.getNewSize=function(){var e=r.el.outerHeight(),t=r.el.outerWidth(),i=r.el.position(),o=i.left+r.parent.scrollLeft(),n=i.top+r.parent.scrollTop();return{outerWidth:t,outerHeight:e,top:n,left:o,right:o+t,bottom:n+e,width:r.el.width(),height:r.el.height()}},this.resize={left:function(){r.el.width(r.actualSize.width-$.clayfy.dX),"relative"!==r.cssPosition&&r.el.css({left:r.actualSize.left+$.clayfy.dX})},top:function(){r.el.height(r.actualSize.height-$.clayfy.dY),"relative"!==r.cssPosition&&r.el.css({top:r.actualSize.top+$.clayfy.dY})},bottom:function(){r.el.height(r.actualSize.height+$.clayfy.dY)},right:function(){r.el.width(r.actualSize.width+$.clayfy.dX)}},this.hideHandlers=function(){"ready"===r.status&&($.each(r.handlers,function(e,t){t.el.css("display","none")}),n=!1)},this.showHandlers=function(){n||"ready"!==r.status&&!r.touchableDevice||($.each(r.handlers,function(e,t){t.el.css("display","block")}),n=!0,r.updateHandlersPosition())},this.updateHandlersPosition=function(){r.newSize=r.getNewSize(),$.each(r.handlers,function(e,t){t.updatePosition()})},this.cancel=function(){console.log("cancelled"),r.status="ready",r.hideHandlers(),r.status="canceling",$("body").trigger("mouseup");var e="relative"!==r.cssPosition?r.initSize:{width:r.initSize.width,height:r.initSize.height};r.el.animate(e,100,function(){r.status="ready",r.el.is(":hover")&&r.showHandlers(),r.el.trigger("clayfy-cancel")})},function(){r.touchableDevice=isTouchDevice(),r.originalSize=r.getSize(),r.actualSize=r.originalSize,r.newSize=r.getNewSize(),s(),r.preserveAspectRatio=r.settings.preserveAspectRatio,r.el.on("clayfy-resizestart",function(e){r.initSize=r.getNewSize(),$(window).on("keydown",a),r.status="resizing"}),r.el.on("clayfy-resizeend",function(){$(window).off("keydown",a),r.status="ready"}),r.el.on("clayfy-dragstart",function(e){e.stopPropagation(),r.initSize=r.getSize(),r.status="dragging"}),r.el.on("clayfy-drop",function(e){e.stopPropagation(),r.status="ready"}),r.el.on("clayfy-resize clayfy-drag",r.updateHandlersPosition),$(window).on("resize",r.updateHandlersPosition),r.el.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",a)}),r.el.on("clayfy-drop",function(e){e.stopPropagation(),$(window).off("keydown",a)});var i=r.el;$.each(r.handlers,function(e,t){r.hideHandlers(),i=i.add(t.el)}),i.on("mouseover",function(){o&&clearTimeout(o),r.showHandlers()}),i.on("mouseout",function(){o=setTimeout(r.hideHandlers,20)}),r.el.on("clayfy-resizeend clayfy-drop",function(e){e.stopPropagation(),r.el.parent().find(":hover").length||r.touchableDevice||(n=!1,r.el.trigger("mouseout"))}),r.touchableDevice&&(i.on("touchstart",function(){o&&clearTimeout(o),r.showHandlers(),o=setTimeout(r.hideHandlers,4e3)}),r.el.on("clayfy-resizeend clayfy-drop",function(){r.el.trigger("click")}))}()}function l(t,i){this.el=$("<div>",{class:"clayfy-handler clayfy-"+t,style:"position: absolute"}),this.resizable=i,this.position=t,this.draggable;var d=this,o=!1;this.updatePosition=function(){var e=i.newSize;switch(d.position){case"left":d.el.css({width:5,left:e.left,top:e.top,height:e.outerHeight});break;case"right":d.el.css({width:5,left:e.right-5,top:e.top,height:e.outerHeight});break;case"top":d.el.css({height:5,left:e.left,top:e.top,width:e.outerWidth});break;case"bottom":d.el.css({height:5,left:e.left,top:e.bottom-5,width:e.outerWidth});break;case"top left":d.el.css({width:8,height:8,left:e.left,top:e.top});break;case"top right":d.el.css({width:8,height:8,left:e.right-8,top:e.top});break;case"bottom left":d.el.css({width:8,height:8,left:e.left,top:e.bottom-8});break;case"bottom right":d.resizable.touchableDevice?d.el.css({width:18,height:18,left:e.right-20,top:e.bottom-20}):d.el.css({width:8,height:8,left:e.right-8,top:e.bottom-8})}},this.setBounderies=function(e){var t,i,o,n,a=e||[1e5,1e5,1e5,1e5],r=[];d.resizable.actualSize=d.resizable.getSize(),t=d.resizable.actualSize,i=d.resizable.settings,o=d.resizable.originalSize.width/d.resizable.originalSize.height,(n=d.draggable.getContainerBounderies())||(n={top:1e13,right:1e13,bottom:1e13,left:1e13});for(var s=0,l=i.maxSize.length;s<l;s++)null===i.maxSize[s]&&(i.maxSize[s]=1e13);$.clayfy.getInner(d.draggable.el);"left"!==d.position&&"top"!==d.position&&"top left"!==d.position||(a[1]=t.outerWidth-i.minSize[0],a[3]=i.maxSize[0]-t.outerWidth,a[2]=t.outerHeight-i.minSize[1],a[0]=i.maxSize[1]-t.outerHeight,d.draggable.settings.bounderies=a,r[3]=Math.min(n.left,a[3],n.top*o,a[0]*o),r[0]=Math.min(n.top,a[0],n.left/o,a[3]/o),r[1]=Math.min(n.right,a[1],n.bottom*o+a[2],a[2]*o),r[2]=Math.min(n.bottom,a[2],n.right/o+a[1],a[1]/o)),"right"!==d.position&&"bottom"!==d.position&&"bottom right"!==d.position||(a[3]=t.outerWidth-i.minSize[0],a[1]=i.maxSize[0]-t.outerWidth,a[0]=t.outerHeight-i.minSize[1],a[2]=i.maxSize[1]-t.outerHeight,d.draggable.settings.bounderies=a,r[1]=Math.min(n.right,a[1],n.bottom*o,a[2]*o),r[2]=Math.min(n.bottom,a[2],n.right/o,a[1]/o),r[3]=Math.min(n.left,a[3],n.top*o+a[0],a[0]*o),r[0]=Math.min(n.top,a[0],n.left/o+a[3],a[3]/o)),"bottom left"===d.position&&(a[0]=t.outerHeight-i.minSize[1],a[1]=t.outerWidth-i.minSize[0],a[2]=i.maxSize[1]-t.outerHeight,a[3]=i.maxSize[0]-t.outerWidth,d.draggable.settings.bounderies=a,r[3]=parseInt(Math.min(n.left,a[3],n.bottom*o,a[2]*o)),r[2]=parseInt(Math.min(n.bottom,a[2],n.left/o,a[3]/o)),r[0]=parseInt(Math.min(n.top,a[0],n.right/o+a[1],a[1]/o)),r[1]=parseInt(Math.min(n.right,a[1],n.top*o+a[0],a[0]*o))),"top right"===d.position&&(a[0]=i.maxSize[1]-t.outerHeight,a[1]=i.maxSize[0]-t.outerWidth,a[2]=t.outerHeight-i.minSize[1],a[3]=t.outerWidth-i.minSize[0],d.draggable.settings.bounderies=a,r[0]=parseInt(Math.min(n.top,a[0],n.right/o,a[1]/o)),r[1]=parseInt(Math.min(n.right,a[1],n.top*o,a[0]*o)),r[3]=parseInt(Math.min(n.left,a[3],n.bottom*o+a[2],a[2]*o)),r[2]=parseInt(Math.min(n.bottom,a[2],n.left/o+a[3],a[3]/o))),d.originalBounderies={top:-a[0],right:a[1],bottom:a[2],left:-a[3]},d.aspectRatioBounderies={top:-r[0],right:r[1],bottom:r[2],left:-r[3]},d.draggable.bounderies=d.resizable.preserveAspectRatio?d.aspectRatioBounderies:d.originalBounderies},this.fixDeltas=function(){var e=$.clayfy;if(d.resizable.preserveAspectRatio)var t=d.resizable.originalSize.width/d.resizable.originalSize.height;if(!d.resizable.preserveAspectRatio&&d.resizable.shiftKey)t=d.resizable.actualSize.width/d.resizable.actualSize.height;(d.resizable.preserveAspectRatio||d.resizable.shiftKey)&&("right"===d.position&&(e.dY=e.dX/t),"bottom"===d.position&&(e.dX=e.dY*t),"left"===d.position&&(e.dY=e.dX/t),"top"===d.position&&(e.dX=e.dY*t),"top left"===d.position&&(e.dY=e.dX/t),"top right"===d.position&&(e.dY=-e.dX/t),"bottom left"===d.position&&(e.dY=-e.dX/t),"bottom right"===d.position&&(e.dY=e.dX/t))},i.settings.className&&d.el.addClass(i.settings.className),d.updatePosition(),d.resizable.el.after(d.el),d.draggable=new c(d.el,{move:!1,container:i.draggable.container,scroll:!1,escape:!1}),d.draggable.el.on("clayfy-drop",function(e){i.el.trigger("clayfy-resizeend"),i.settings.callbacks.resizeend()}),d.draggable.el.on("clayfy-dragstart",function(e){e.stopPropagation(),d.resizable.preserveAspectRatio||(d.resizable.originalSize=d.resizable.getSize()),i.el.trigger("clayfy-beforeresize"),d.setBounderies(),i.el.trigger("clayfy-resizestart"),i.settings.callbacks.resizestart(),o=!1}),d.draggable.el.on("clayfy-drag",function(e){e.shiftKey&&!i.preserveAspectRatio&&(i.shiftKey=!0),e.shiftKey||(i.shiftKey=!1),!o||e.shiftKey||i.preserveAspectRatio||(console.log("Desactivate: preserve aspect ratio"),d.draggable.bounderies=d.originalBounderies,o=!1),o||!e.shiftKey||i.preserveAspectRatio||(console.log("Activate: preserve aspect ratio"),d.draggable.bounderies=d.aspectRatioBounderies,o=!0),i.preserveAspectRatio&&!i.shiftKey&&(d.draggable.bounderies=d.aspectRatioBounderies)}),-1<t.indexOf("left")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"left"===t&&i.resize.top()),i.resize.left()}),-1<t.indexOf("top")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"top"===t&&i.resize.left()),i.resize.top()}),-1<t.indexOf("right")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"right"===t&&i.resize.bottom()),i.resize.right()}),-1<t.indexOf("bottom")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"bottom"===t&&i.resize.right()),i.resize.bottom()}),d.draggable.el.on("clayfy-drag",function(e){i.el.trigger("clayfy-resize"),i.settings.callbacks.resize()}),d.resizable.touchableDevice&&d.el.addClass("clayfy-touch-device")}function a(e,t){this.el=e instanceof $?e:$(e),this.draggableBox,this.dropArea=$("<div>",{class:"clayfy-sort-droparea"}),this.draggable,this.droppable,this.droppableParent,this.index,this.indexRelative,this.parent,this.callableIfNotMove=new E,this.settings=$.extend(!0,{},$.clayfy.settings,t);var a,i,r=this,o=function(e){27===e.keyCode&&r.cancel()},n=function(){r.draggableBox=r.el.clone(),r.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-sort-dragging");var e=r.el.parent();"static"===e.css("position")&&e.css("position","relative")},s=function(){f(),p(),r.index=r.droppable.index(r.el),r.parent=r.el.parent(),r.indexRelative=r.parent.find(r.droppable).index(r.el),r.draggableBox.css({width:r.el.outerWidth(),height:r.el.outerHeight(),top:r.el.position().top,left:r.el.position().left}),l(),r.draggableBox.appendTo(r.parent),r.el.css({visibility:"hidden"})},l=function(){r.dropArea.appendTo(r.el.parent()),r.dropArea.css({position:"absolute",width:r.el.outerWidth(),height:r.el.outerHeight(),top:r.el.position().top+parseInt(r.el.css("margin-top"))-parseInt(r.dropArea.css("border-top-width")),left:r.el.position().left+parseInt(r.el.css("margin-left"))-parseInt(r.dropArea.css("border-left-width"))})},d=function(e){f(),!1!==r.el.triggerHandler("validateChange")&&(r.parent.is($(r.droppedTarget).parent())||r.settings.export)&&!a||function(){var e=r.parent.find(r.droppable);if(r.parent.is($(r.droppedTarget).parent())){var t=e.index(r.el);r.indexRelative<t?e.eq(r.indexRelative).before(r.el):e.eq(r.indexRelative).after(r.el)}else e.length?e.eq(r.indexRelative).before(r.el):r.parent.append(r.el);l()}();var t=r.dropArea.parent().offset(),i=r.draggableBox.parent().offset(),o=r.el.position().left+(t.left-i.left),n=r.el.position().top+(t.top-i.top);return r.draggableBox.animate({top:n,left:o},200,function(){r.dropArea.detach(),r.el[0].style.visibility="",r.draggableBox.detach(),f();var e=r.droppable.index(r.el);e!=r.index&&(r.index=e,r.el.trigger($.Event("clayfy-changeorder",{index:r.index,order:r.droppable}))),r.el.parent().find(".clayfy-sort-helper").remove()}),a=!1},g=function(e){if(!r.el.is(e.target)){f();var t=r.droppable.index(e.target),i=r.droppable.index(r.el);r.droppedTarget=e.target,i<t?$(e.target).after(r.el):$(e.target).before(r.el),l(),r.draggable.updateDropArea(),r.parent.find(r.droppable).length<2?r.parent.find(".clayfy-sort-helper").length||r.parent.append('<div class="clayfy-sort-helper" style="position: absolute; width: 100%; height: 100%; top: 0; left:0; "></div>'):r.parent.find(".clayfy-sort-helper").remove(),$(".clayfy-sort-helper").each(function(){var e=$(this);e.parent().is(r.droppableParent)&&r.draggable.addDroppable(e)})}},f=function(){r.settings.siblings?r.droppable=r.settings.siblings instanceof $?r.settings.siblings:$(r.settings.siblings):r.droppable=r.el.siblings().andSelf()},p=function(){r.droppableParent||(r.droppableParent=r.el.parent()),r.droppable.each(function(){r.droppableParent=r.droppableParent.add($(this).parent())})};this.cancel=function(){a=!0,$("body").trigger("mouseup")},function(){f(),p(),n(),i=$(r.settings.not),r.el.on("mousedown touchstart",function(e){"mousedown"===e.type&&1!==e.which||i.is(e.target)||i.has(e.target).length||(e.preventDefault(),r.callableIfNotMove.callFunction(e,r.settings.delay,function(){s(),r.draggableBox.trigger($.Event(e.type,e))}))});var e=$.extend(!0,{},r.settings,{droppable:r.droppable,escape:!1,dropoutside:!0,delay:0});r.draggable=new c(r.draggableBox,e),r.draggableBox.on("clayfy-drop",d),r.draggableBox.on("clayfy-dropoutside",function(e){return!1}),r.draggableBox.on("clayfy-dragenter",g),r.draggableBox.on("clayfy-dragstart",function(){r.draggable.resetDroppable(r.droppable),$(".clayfy-sort-helper").each(function(){var e=$(this);e.parent().is(r.droppableParent)&&r.draggable.addDroppable(e)})}),r.draggableBox.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",o)}),r.draggableBox.on("clayfy-drop",function(){$(window).off("keydown",o)})}()}$.clayfy={dX:0,dY:0,container:function(e,t){return new I(e,t)},settings:{type:"draggable",bounderies:[1e7,1e7,1e7,1e7],container:"",moveX:!0,moveY:!0,move:!0,not:"",ghost:!1,coverScreen:!0,scrollable:"",droppable:"",fit:!0,dropoutside:!1,migrate:!1,overflow:!1,escape:!0,propagate:!0,mobileDelay:100,helperOnMobile:!0,delay:100,preserveAspectRatio:!1,maxSize:[500,200],minSize:[100,50],left:!0,top:!0,right:!0,bottom:!0,className:"",siblings:"",export:!0,dragstart:function(e){},drag:function(e){},drop:function(e){}},getInner:function(e){var t,i,o,n,a,r=e instanceof $?e:$(e);return r.length?(t=r[0].style.position,"static"===r.css("position")&&r.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),r.append(o),n=i.width(),a=i.height(),o.remove(),r[0].style.position=t,{innerWidth:n,innerHeight:a}):{width:0,height:0}}};var r,s="clayfy";$.fn[s]=function(t){var i=arguments;if(void 0===t||"object"==typeof t){var e=$.clayfy.settings.type;switch(void 0!==t&&void 0!==t.type&&(e=t.type),e){case"draggable":r=c;break;case"resizable":r=n;break;case"sortable":r=a}return this.each(function(){$.data(this,s)||$.data(this,s,new r(this,t))})}if("string"==typeof t&&"_"!==t[0]&&"init"!==t){if("instance"===t)return this.length?$.data(this[0],s):null;if(0!=Array.prototype.slice.call(i,1).length||-1==$.inArray(t,$.fn[s].getters))return this.each(function(){var e=$.data(this,s);"function"==typeof e[t]&&e[t].apply(e,Array.prototype.slice.call(i,1))});var o=$.data(this[0],s);return o[t].apply(o,Array.prototype.slice.call(i,1))}},$.fn[s].getters=["getPosition"]}(jQuery),isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints};
